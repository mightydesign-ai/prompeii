<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Prompeii Admin Console — Edit Prompt</title>
  <link rel="stylesheet" href="admin-edit.css" />
</head>

<body class="admin-body">
  <!-- Header -->
  <header class="admin-header">
    <div>
      <h1>Prompeii Admin Console</h1>
      <p class="admin-subtitle">Edit and refine curated prompts in your catalog.</p>
    </div>

    <div class="admin-actions">
      <a href="admin.html" class="btn btn-ghost">&larr; Back to Prompt List</a>
    </div>
  </header>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Main -->
  <main class="admin-main">
    <section class="panel panel-edit">
      <header class="panel-header">
        <div>
          <h2>Edit Prompt</h2>
          <p class="panel-subtitle">Modify metadata, content, and quality settings.</p>
        </div>

        <div class="panel-actions">
          <a href="admin.html" class="btn btn-secondary">Back</a>
          <button id="btnDuplicate" class="btn btn-secondary">Duplicate</button>
          <button id="btnSave" class="btn btn-primary">Save Changes</button>
        </div>
      </header>

      <!-- System metadata -->
      <section class="system-metadata">
        <div class="meta-row">
          <span class="meta-label">Prompt ID</span>
          <span id="metaId">—</span>
        </div>
        <div class="meta-row">
          <span class="meta-label">Created</span>
          <span id="metaCreated">—</span>
        </div>
        <div class="meta-row">
          <span class="meta-label">Updated</span>
          <span id="metaUpdated">—</span>
        </div>
      </section>

      <form id="editPromptForm" class="edit-form" novalidate>
        <div class="edit-layout">
          <!-- LEFT COLUMN -->
          <div class="edit-column">
            <!-- General Metadata -->
            <section class="form-section">
              <h3 class="section-title">General Metadata</h3>
              <p class="section-description">
                Core details used to organize and surface the prompt.
              </p>

              <div class="field-group">
                <div class="field-header">
                  <label for="smartTitleHuman" class="field-label">
                    Smart Title <span class="required">*</span>
                  </label>
                  <button type="button" id="btnAiTitle" class="btn btn-ghost-compact">
                    AI Title
                  </button>
                </div>
                <input
                  id="smartTitleHuman"
                  class="input"
                  required
                  placeholder="e.g. Make ChatGPT sound naturally human"
                />
                <p class="field-hint">
                  Short, descriptive, and scannable. Shown on cards.
                </p>
                <p class="field-error" data-error-for="smartTitleHuman"></p>
              </div>

              <div class="field-grid field-grid-2">
                <div class="field-group">
                  <label class="field-label">Category *</label>
                  <select id="category" class="input" required>
                    <option value="">Select a category</option>
                    <option value="Writing">Writing</option>
                    <option value="Coding">Coding</option>
                    <option value="Design">Design</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Productivity">Productivity</option>
                    <option value="Education">Education</option>
                    <option value="Research">Research</option>
                    <option value="Other">Other</option>
                  </select>
                  <p class="field-error" data-error-for="category"></p>
                </div>

                <div class="field-group">
                  <label class="field-label">Status *</label>
                  <select id="status" class="input">
                    <option value="draft">Draft</option>
                    <option value="published">Published</option>
                    <option value="archived">Archived</option>
                  </select>
                </div>
              </div>

              <div class="field-group">
                <div class="field-header">
                  <label class="field-label" for="tags">Tags</label>
                  <button type="button" id="btnAiTags" class="btn btn-ghost-compact">
                    AI Tags
                  </button>
                </div>
                <input
                  id="tags"
                  class="input"
                  placeholder="email, tone, outreach"
                />
                <p class="field-hint">Comma-separated. Saved as text[] array.</p>
              </div>

              <div class="field-grid field-grid-2">
                <div class="field-group">
                  <label class="field-label">Tone</label>
                  <select id="tone" class="input">
                    <option value="">—</option>
                    <option value="casual">Casual</option>
                    <option value="professional">Professional</option>
                    <option value="playful">Playful</option>
                    <option value="formal">Formal</option>
                    <option value="technical">Technical</option>
                  </select>
                </div>

                <div class="field-group">
                  <label class="field-label">Use Case</label>
                  <select id="useCase" class="input">
                    <option value="">—</option>
                    <option value="copywriting">Copywriting</option>
                    <option value="ideation">Ideation</option>
                    <option value="analysis">Analysis</option>
                    <option value="brainstorming">Brainstorming</option>
                    <option value="research">Research</option>
                    <option value="coding">Coding</option>
                  </select>
                </div>
              </div>

              <div class="field-grid field-grid-2">
                <div class="field-group">
                  <label class="field-label">Skill Level</label>
                  <select id="skillLevel" class="input">
                    <option value="">—</option>
                    <option value="beginner">Beginner</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="advanced">Advanced</option>
                  </select>
                </div>

                <div class="field-group">
                  <label class="field-label">Model</label>
                  <input id="model" class="input" placeholder="gpt-4.1, gpt-5.1, claude-3.5" />
                </div>
              </div>
            </section>

            <!-- Quality -->
            <section class="form-section">
              <div class="section-header-row">
                <h3 class="section-title">Quality Scoring</h3>
                <button
                  type="button"
                  id="btnAiScore"
                  class="btn btn-ghost-compact"
                >
                  AI Score
                </button>
              </div>
              <p class="section-description">
                Internal scoring used to prioritize and explain why this prompt is featured.
              </p>

              <div class="field-grid field-grid-3">
                <div class="field-group">
                  <label class="field-label">Clarity</label>
                  <input id="clarity" type="number" min="1" max="5" class="input" />
                </div>

                <div class="field-group">
                  <label class="field-label">Creativity</label>
                  <input id="creativity" type="number" min="1" max="5" class="input" />
                </div>

                <div class="field-group">
                  <label class="field-label">Usefulness</label>
                  <input id="usefulness" type="number" min="1" max="5" class="input" />
                </div>
              </div>

              <div class="field-group">
                <label class="field-label">Quality Score (avg)</label>
                <input id="qualityScore" class="input" readonly />
                <p class="field-hint">Auto-calculated or set via AI scoring.</p>
              </div>
            </section>
          </div>

          <!-- RIGHT COLUMN -->
          <div class="edit-column">
            <section class="form-section">
              <div class="field-group">
                <div class="field-header">
                  <label class="field-label" for="intro">
                    Intro <span class="required">*</span>
                  </label>
                  <button
                    type="button"
                    id="btnAiIntro"
                    class="btn btn-ghost-compact"
                  >
                    AI Intro
                  </button>
                </div>
                <textarea
                  id="intro"
                  rows="4"
                  class="input textarea"
                  required
                ></textarea>
                <p class="field-error" data-error-for="intro"></p>
              </div>

              <div class="field-group">
                <div class="field-header">
                  <label class="field-label" for="prompt">
                    Prompt <span class="required">*</span>
                  </label>
                  <button
                    type="button"
                    id="btnAiImprovePrompt"
                    class="btn btn-ghost-compact"
                  >
                    Improve
                  </button>
                </div>
                <textarea
                  id="prompt"
                  rows="16"
                  class="input textarea textarea-code"
                  required
                ></textarea>
                <p class="field-error" data-error-for="prompt"></p>
              </div>

              <div class="readonly-card">
                <div class="meta-row">
                  <span class="meta-label">Detected Variables</span>
                  <span id="detectedVariables">—</span>
                </div>
                <div class="meta-row">
                  <span class="meta-label">Estimated Tokens</span>
                  <span id="estimatedTokens">—</span>
                </div>
                <div class="meta-row">
                  <span class="meta-label">Length Label</span>
                  <span id="lengthLabel">—</span>
                </div>
              </div>

              <!-- PREVIEW PANEL -->
              <section class="preview-panel">
                <div class="preview-header">
                  <h3 class="preview-title">Preview Output</h3>
                  <button id="btnRunPreview" type="button" class="btn btn-primary">
                    Run Prompt
                  </button>
                </div>

                <div class="preview-vars">
                  <p class="preview-vars-title">Variables</p>
                  <div id="previewVarsContainer" class="preview-vars-list">
                    <!-- auto-generated var inputs -->
                  </div>
                </div>

                <div class="preview-output-container">
                  <pre id="previewOutput" class="preview-output">
Run the prompt to preview the result…
                  </pre>
                </div>

                <div class="preview-controls">
                  <button id="btnCopyPreview" type="button" class="btn btn-secondary">
                    Copy Output
                  </button>
                </div>
              </section>
            </section>

            <!-- Danger Zone -->
            <section class="danger-zone">
              <h3 class="danger-title">Danger Zone</h3>
              <p class="danger-description">
                Deleting this prompt is permanent. There is no undo.
              </p>
              <button id="btnDelete" type="button" class="btn btn-danger">
                Delete Prompt
              </button>
            </section>
          </div>
        </div>
      </form>
    </section>
  </main>

  <!-- Improve Prompt Modal -->
  <div id="improveModalOverlay" class="modal-overlay" hidden></div>
  <div id="improveModal" class="modal-container" hidden>
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">AI Improved Prompt</h2>
        <button id="btnCloseImproveModal" type="button" class="modal-close">×</button>
      </div>
      <div class="modal-body">
        <div class="diff-columns">
          <div class="diff-col">
            <h3 class="diff-title">Original</h3>
            <pre id="diffOriginal" class="diff-block"></pre>
          </div>
          <div class="diff-col">
            <h3 class="diff-title">Improved</h3>
            <pre id="diffImproved" class="diff-block"></pre>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="btnAcceptImproved" type="button" class="btn btn-primary">
          Apply Changes
        </button>
        <button id="btnCancelImproved" type="button" class="btn btn-secondary">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="admin-edit.js"></script>
</body>
</html>
